alter table engineered_gene add (mod_type_unctrl_vocab varchar2(255));
alter table env_factor add (name_unctrl_vocab varchar2(255));
alter table env_factor add (type_unctrl_vocab varchar2(255));
alter table image add (STAINING_UNCTRL_VOCAB varchar2(255));
alter table treatment add (admin_route_unctrl_vocab varchar2(255));


update therapy set therapeutic_experiment = 0  where therapeutic_experiment is null;
update env_factor set is_cmap_agent=0 where is_cmap_agent is null;
update publication set first_time_reported = 0 where first_time_reported is null;

select abs_cancer_model_type, count(*) from abs_cancer_model
 group by abs_cancer_model_type;
 
select distinct acm.abs_cancer_model_id, acm.abs_cancer_model_type
 from abs_cancer_model acm, (
select abs_cancer_model_id, abs_cancer_model_type, par_abs_can_model_id
 from abs_cancer_model
 where par_abs_can_model_id is not null
 connect by prior par_abs_can_model_id = abs_cancer_model_id
) t
 where acm.abs_cancer_model_id = t.par_abs_can_model_id

select acm.abs_cancer_model_type,
       acm.taxon_id,
       sr.stage stage,
       t.dosage,
       sr.aveinh aveinh,
       sr.diffinh diffinh
  from screening_Result sr,
       env_factor a,
       YST_MDL_SCRNING_RESULT ymsr,
       abs_cancer_model acm,
       treatment t
 where sr.agent_id = a.env_factor_id
   and sr.screening_result_id = ymsr.screening_result_id
   and sr.treatment_id = t.treatment_id
   and ymsr.abs_cancer_model_id = acm.abs_cancer_model_id
   and a.nsc_number in (337250, 122758)

select distinct a.nsc_number
  from screening_Result sr,
       env_factor a,
       YST_MDL_SCRNING_RESULT ymsr,
       abs_cancer_model acm
 where sr.agent_id = a.env_factor_id
   and sr.screening_result_id = ymsr.screening_result_id
   and ymsr.abs_cancer_model_id = acm.abs_cancer_model_id
   --and a.nsc_number = 704805




select acm.abs_cancer_model_id, 
       acm.abs_cancer_model_type,
       ef.env_factor_id,
       ef.nsc_number
  from abs_cancer_model acm,
       animal_model_therapy amt,
       therapy t,
       env_factor ef
 where acm.abs_cancer_model_id = amt.abs_cancer_model_id
   and amt.therapy_id = t.therapy_id
   and t.env_factor_id = ef.env_factor_id
   and ef.nsc_number in (
select distinct a.nsc_number
  from screening_Result sr,
       env_factor a
 where sr.agent_id = a.env_factor_id )
 
 
select tx.ethnicity_strain,
       sr.stage stage,
       t.dosage,
       sr.aveinh aveinh,
       sr.diffinh diffinh,
       a.env_factor_id
  from screening_Result sr,
       env_factor a,
       YST_MDL_SCRNING_RESULT ymsr,
       abs_cancer_model acm,
       treatment t,
       taxon tx
 where sr.agent_id = a.env_factor_id
   and sr.screening_result_id = ymsr.screening_result_id
   and sr.treatment_id = t.treatment_id
   and ymsr.abs_cancer_model_id = acm.abs_cancer_model_id
   and acm.taxon_id = tx.taxon_id
   and a.nsc_number = 122758--in (337250, 122758)
   
   
select tx.ethnicity_strain,
       t.dosage,
       sr.aveinh aveinh,
       sr.diffinh diffinh
  from screening_Result sr,
       env_factor a,
       YST_MDL_SCRNING_RESULT ymsr,
       abs_cancer_model acm,
       treatment t,
       taxon tx
 where sr.agent_id = a.env_factor_id
   and sr.screening_result_id = ymsr.screening_result_id
   and sr.treatment_id = t.treatment_id
   and ymsr.abs_cancer_model_id = acm.abs_cancer_model_id
   and acm.taxon_id = tx.taxon_id
   and a.nsc_number = 122758--in (337250, 122758)
   
   
select tx.ethnicity_strain,
       t.dosage,
       sr.aveinh aveinh,
       sr.diffinh diffinh,
       a.env_factor_id,
       ymsr.abs_cancer_model_id
  from screening_Result sr,
       env_factor a,
       YST_MDL_SCRNING_RESULT ymsr,
       abs_cancer_model acm,
       treatment t,
       taxon tx
 where sr.agent_id = a.env_factor_id
   and sr.screening_result_id = ymsr.screening_result_id
   and sr.treatment_id = t.treatment_id
   and ymsr.abs_cancer_model_id = acm.abs_cancer_model_id
   and acm.taxon_id = tx.taxon_id
   and a.nsc_number = 122758
   and sr.stage = '0'
 order by 1, 2
 
 
select acm.abs_cancer_model_id, 
       acm.abs_cancer_model_type,
       ef.env_factor_id,
       ef.nsc_number
  from abs_cancer_model acm,
       animal_model_therapy amt,
       therapy t,
       env_factor ef
 where acm.abs_cancer_model_id = amt.abs_cancer_model_id
   and amt.therapy_id = t.therapy_id
   and t.env_factor_id = ef.env_factor_id
   and ef.nsc_number in (
select distinct a.nsc_number
  from invivo_Result sr,
       env_factor a
 where sr.agent_id = a.env_factor_id )
 
 
select acm.abs_cancer_model_id,
       acm.model_descriptor,
       tx.ethnicity_strain,
       count(*)
  from invivo_Result sr,
       env_factor a,
       XENOGRAFT_INVIVO_RESULT ymsr,
       abs_cancer_model acm,
       treatment t,
       taxon tx
 where sr.agent_id = a.env_factor_id
   and sr.invivo_result_id = ymsr.invivo_result_id
   and sr.treatment_id = t.treatment_id
   and ymsr.abs_cancer_model_id = acm.abs_cancer_model_id
   and acm.taxon_id = tx.taxon_id
   and a.nsc_number = 122758--in (337250, 122758)
 group by acm.abs_cancer_model_id, acm.model_descriptor, tx.ethnicity_strain
 order by 3, 2

 
 
select invivoresu0_.abs_cancer_model_id as abs1___, 
       invivoresu0_.invivo_result_id as invivo2___, invivoresu1_.invivo_result_id as invivo1_0_, 
       invivoresu1_.evaluationDay as evaluati2_25_0_, 
       invivoresu1_.toxicitySurvivors as toxicity3_25_0_, 
       invivoresu1_.toxicityEvalDay as toxicity4_25_0_, 
       invivoresu1_.percent_treated_control as percent5_25_0_, 
       invivoresu1_.endpoint_code_id as endpoint6_25_0_, invivoresu1_.treatment_id as treatment7_25_0_,
       invivoresu1_.agent_id as agent8_25_0_ 
  from xenograft_invivo_result invivoresu0_ 
     inner join invivo_result invivoresu1_ on 
     invivoresu0_.invivo_result_id=invivoresu1_.invivo_result_id 
  where invivoresu0_.abs_cancer_model_id=718

select count(*)
  from xenograft_invivo_result invivoresu0_ 
     inner join invivo_result invivoresu1_ on 
     invivoresu0_.invivo_result_id=invivoresu1_.invivo_result_id 
  where invivoresu0_.abs_cancer_model_id=718
  
select xenograftc0_.par_abs_can_model_id as par28___, 
	xenograftc0_.abs_cancer_model_id as abs1___, 
	xenograftc0_.abs_cancer_model_id as abs1_0_, 
	xenograftc0_.experiment_design as experiment3_2_0_, 
	xenograftc0_.model_descriptor as model4_2_0_, 
	xenograftc0_.state as state2_0_, 
	xenograftc0_.availability_id as availabi6_2_0_, 
	xenograftc0_.taxon_id as taxon7_2_0_, 
	xenograftc0_.submitter_id as submitter8_2_0_, 
	xenograftc0_.principal_investigator_id as principal9_2_0_, 
	xenograftc0_.administrative_site as adminis10_2_0_, 
	xenograftc0_.genetic_manipulation as genetic11_2_0_, 
	xenograftc0_.modification_description as modific12_2_0_, 
	xenograftc0_.parental_cell_line_name as parental13_2_0_, 
	xenograftc0_.name as name2_0_, xenograftc0_.atcc_number as atcc15_2_0_, 
	xenograftc0_.cell_amount as cell16_2_0_, xenograftc0_.harvest_date as harvest17_2_0_, 
	xenograftc0_.graft_type as graft18_2_0_, xenograftc0_.graft_type_unctrl_vocab as graft19_2_0_, 
	xenograftc0_.tumor_code_id as tumor20_2_0_, xenograftc0_.origin_species_id as origin21_2_0_, 
	xenograftc0_.host_species_id as host22_2_0_, xenograftc0_.organ_id as organ23_2_0_ 
 from abs_cancer_model xenograftc0_ where xenograftc0_.par_abs_can_model_id=1036 --?
 


/* engineered gene, tms etc. */
 select engineered_gene_type, count(*) from engineered_gene
  group by engineered_gene_type
  
ENGINEERED   COUNT(*)
---------- ----------
GS                  3
IM                 62
T                 440
TM                339


select abs_cancer_model_id, eg.engineered_gene_type
  from ani_mod_engineered_gene ameg, 
       engineered_gene eg
 where ameg.engineered_gene_id = eg.engineered_Gene_id
   and eg.engineered_gene_type in ('GS', 'IM')
   
select modeluid from abs_cancer_model_tmp where abs_cancer_model_id in (
select abs_cancer_model_id
  from ani_mod_engineered_gene ameg, 
       engineered_gene eg
 where ameg.engineered_gene_id = eg.engineered_Gene_id
   and eg.engineered_gene_type in ('GS', 'IM')
)


select distinct abs_cancer_model_id 
  from ANIMAL_MODEL_THERAPY amt,
       therapy t
 where t.therapeutic_experiment = 0
   and t.therapy_id = amt.therapy_id

select type, count(*)
  from env_factor e,
       therapy t
 where e.env_factor_id = t.env_factor_id
   and t.therapeutic_experiment = 0
 group by rollup(type)   

 
select agent0_.env_factor_id as env1_0_, agent0_.env_factor_type, agent0_.type as type50_0_
  from env_factor agent0_ 
 where agent0_.env_factor_id in (
 select distinct t.env_Factor_id
  from ANIMAL_MODEL_THERAPY amt,
       therapy t
 where t.therapeutic_experiment = 0
   and t.therapy_id = amt.therapy_id )
--   and agent0_.env_factor_type='AG'


select t.therapy_id, e.env_factor_id, e.env_factor_type, e.type
  from env_factor e,
       therapy t,
       animal_model_therapy amt
 where amt.therapy_id = t.therapy_id
   and t.env_Factor_id = e.env_factor_id
   and t.therapeutic_experiment = 0
   and amt.abs_cancer_model_id = 190



select ca.AGENTCATEGORY,
       ca.AGENTNAME,
       c.CARCINOGENUID,
       c.MODELKEY,
       c.CARCINOGENAGENTKEY,
       c.SEX,
       c.AGE,
       c.CARCINOGENAGENTADMINKEY,
       c.DOSE,
       c.TREATMENTLENGTH
  from CARCINOGEN c,CARCINOGENAGENT ca
 where c.MODELKEY = 1782
   and c.CARCINOGENAGENTKEY = ca.CARCINOGENAGENTUID
 order by c.CARCINOGENUID


select therapy_id, therapyuid, carcinogenuid, carcinogenagentkey
  from therapy_tmp
 where carcinogenuid in (1552, 1553, 1554, 1555, 1556)

select name, env_factor_type, type
   from env_factor_tmp
  where carcinogenagentuid in (  59, 59, 23, 148, 163)


select acm.abs_cancer_model_id,
       t.therapy_id
  from abs_cancer_model_tmp acm,
       therapy_tmp t,
       therapy@camodop_datop tc
 where acm.modeluid = tc.modelkey
   and t.therapyuid = tc.therapyuid
order by 1

select acm.abs_cancer_model_id,
       t.therapy_id
  from abs_cancer_model_tmp acm,
       therapy_tmp t,
       carcin@camodop_datop tc
 where acm.modeluid = tc.modelkey
   and t.therapyuid = tc.therapyuid

select publication_id, year, authors
  from publication
 where publication_id in (
	select min(publication_id) publication_id
	  from publication
	 where pmid in (
		select distinct pmid
		  from animal_model_therapy amt,
		       therapy_publication tp,
		       publication p
		 where amt.abs_cancer_model_id = 3
		   and amt.therapy_id = tp.therapy_id
		   and tp.publication_id = p.publication_id
		union
		select distinct pmid
		  from ani_mod_cell_line acl,
		       cell_line_publication cp,
		       publication p
		 where acl.abs_cancer_model_id = 3
		   and acl.cell_line_id = cp.cell_line_id
		   and cp.publication_id = p.publication_id
		union
		select distinct pmid
		  from abs_can_mod_publication acmp,
		       publication p
		 where acmp.abs_cancer_model_id = 3
		   and acmp.publication_id = p.publication_id )
	 group by pmid )
 order by year desc, authors

ALTER SEQUENCE hibernate_sequence
INCREMENT BY 1000000;

SELECT hibernate_sequence.NEXTVAL FROM dual;

ALTER SEQUENCE hibernate_sequence
INCREMENT BY 1;



http://caimage.nci.nih.gov/lizardtech//iserv/getthumb?cat=Model&img=277.sid
http://caimage.nci.nih.gov/lizardtech//iserv/catalogviewtumors.jsp?cat=Model&img=277.sid

alter table sex_distribution add constraint sex_distribution_type_unq unique(type);
alter table ANIMAL_DISTRIBUTOR add constraint ANIMAL_DISTRIBUTOR_name_unq unique(name);
alter table CHEMICAL_CLASS add constraint CHEMICAL_CLASS_name_unq unique(CHEMICAL_CLASS_NAME);
alter table BIOLOGICAL_PROCESS add constraint BIOLOGICAL_PROCESS_name_unq unique(PROCESS_NAME);
alter table AGENT_TARGET add constraint TARGET_name_unq unique(TARGET_NAME);
alter table EXP_LEVEL_DESC add constraint EXP_LEVEL_unq unique(EXPRESSION_LEVEL);
alter table publication_status add constraint publication_status_name_unq unique(name);
alter table REG_ELEMENT_TYPE add constraint REG_ELEMENT_TYPE_name_unq unique(name);
alter table modification_type add constraint modification_type_name_unq unique(name);
alter table party add constraint party_username_unq unique(username);
alter table model_section add constraint model_section_name_unq unique(name);



select id, name, NUMBEROFFEATURES,
     ( select count(*)
 	     from ARRAYDESIGNFEATUREGRP adfg,
		 	  FEATURE f
	    where adfg.array_design_id = ad.id
		  and adfg.FEATURE_GROUP_ID = f.FEATURE_GROUP_ID ) n_feature,
     ( select count(*)
 	     from ARRAYDESIGNCOMPOSITEGRP adcg,
		 	  COMPOSITESEQUENCE cs
	    where adcg.array_design_id = ad.id
		  and adcg.COMPOSITE_GROUP_ID = cs.COMPOSITE_GROUP_ID ) n_comp_sequence,
     ( select count(*)
 	     from ARRAYDESIGNREPORTERGRP adrg,
		 	  REPORTER r
	    where adrg.array_design_id = ad.id
		  and adrg.reporter_group_id = r.reporter_group_id ) n_reporter
  from arraydesign ad
 where ad.deleted != 1
   and exists (
     select null
       from AS_protection_element pe,
            AS_PROTECTION_GROUP_ELEMENT pge
      where pe.PROTECTION_ELEMENT_ID = pge.PROTECTION_ELEMENT_ID
        and pge.PROTECTION_GROUP_ID = 0
        and instr(object_id, 'arraydesign') > 0
		and replace(object_id, 'caarray;arraydesign;', '') = ad.id
     )